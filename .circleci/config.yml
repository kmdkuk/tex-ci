version: 2
jobs:
  textlint:
    working_directory: ~/project
    docker:
      - image: circleci/node:8
    steps:
      - checkout
      - restore_cache:
          key: dependency-{{ checksum "package-lock.json" }}
      - run: npm install
      - save_cache:
          key: dependency-{{ checksum "package-lock.json"}}
          path: node_modules
      - run: npm run --silent texlint-check --textpath paper/sample.tex
  build:
    working_directory: ~/project
    docker:
      - image: paperist/alpine-texlive-ja
    steps:
      - checkout
      - run: apk add --no-cache ca-certificates
      - run: cp .latexmkrc ~/.latexmkrc
      - run:
          command: latexmk
          working_directory: paper
      - run: cp paper/*.pdf artifacts/
      - store_artifacts:
          path: artifacts

workflows:
  version: 2
  textlint-makepdf:
    jobs:
      - textlint
      - build:
          requires:
            - textlint
